

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Playing with buildign blocks - Creating JavaScript Web Services &mdash; ZOO-Project 1.5 documentation</title>
  
  <link href="http://fonts.googleapis.com/css?family=Days+One" rel="stylesheet" type="text/css">
  
  

  

  
  
    
      <link rel="search" type="application/opensearchdescription+xml" title="Search within ZOO-Project 1.5 documentation" href="_static/opensearch.xml"/>
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ZOO-Project 1.5 documentation" href="index.html"/>
        <link rel="prev" title="Building blocks presentation - Using OGR and PgRouting based Web Services" href="building_blocks_presentation.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
	  <a class="shrink" href="http://zoo-project.org"><img src="http://zoo-project.org/img/zoo-sun-logo.png" class="img-responsive sun" style="display: inline;"> ZOO</a>
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#what-is-zoo">What is ZOO ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#how-does-zoo-works">How does ZOO works ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#what-are-we-going-to-do-in-this-workshop">What are we going to do in this workshop?</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#usefull-tips-for-reading">Usefull tips for reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="using_zoo_from_osgeolivevm.html">Configuration and ZOO-Kernel use</a><ul>
<li class="toctree-l2"><a class="reference internal" href="using_zoo_from_osgeolivevm.html#zoo-project-installation">ZOO-Project Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_zoo_from_osgeolivevm.html#zoo-kernel-configuration">ZOO-Kernel Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_zoo_from_osgeolivevm.html#testing-the-zoo-installation-with-getcapabilities">Testing the ZOO installation with GetCapabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="first_service.html">Creating your first ZOO Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="first_service.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html#service-and-publication-process-overview">Service and publication process overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html#creating-your-first-zcfg-file">Creating your first ZCFG file</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html#test-requests">Test requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html#implementing-the-python-service">Implementing the Python Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html#interracting-with-your-service-using-execute-requests">Interracting with your service using Execute requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="building_blocks_presentation.html">Building blocks presentation - Using OGR and PgRouting based Web Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="building_blocks_presentation.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_blocks_presentation.html#services-provider-and-configuration-files">Services Provider and configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_blocks_presentation.html#the-buffer-service">The Buffer Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_blocks_presentation.html#the-intersection-service">The Intersection Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_blocks_presentation.html#the-differencepy-service">The DifferencePy Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_blocks_presentation.html#the-routing-and-profile-services">The Routing and Profile Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_blocks_presentation.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Playing with buildign blocks - Creating JavaScript Web Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zoo-api-overview">ZOO-API Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-mask-service">The Mask Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#buffermask-service">BufferMask Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bufferrequest-service">BufferRequest service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-union-into-the-chain">Add Union into the chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ZOO-Project</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">

    <li><a href="index.html"> Docs</a> &#8725; &#160;</li>
      
    <li>Playing with buildign blocks - Creating JavaScript Web Services</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/js_services_chaining.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="playing-with-buildign-blocks-creating-javascript-web-services">
<span id="ogr-base-vect-ops"></span><h1><a class="toc-backref" href="#table-of-contents">Playing with buildign blocks - Creating JavaScript Web Services</a><a class="headerlink" href="#playing-with-buildign-blocks-creating-javascript-web-services" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#playing-with-buildign-blocks-creating-javascript-web-services" id="id12">Playing with buildign blocks - Creating JavaScript Web Services</a><ul>
<li><a class="reference internal" href="#introduction" id="id13">Introduction</a></li>
<li><a class="reference internal" href="#zoo-api-overview" id="id14">ZOO-API Overview</a></li>
<li><a class="reference internal" href="#the-mask-service" id="id15">The Mask Service</a><ul>
<li><a class="reference internal" href="#the-zcfg" id="id16">The ZCFG</a></li>
<li><a class="reference internal" href="#the-javascript-service" id="id17">The JavaScript service</a></li>
<li><a class="reference internal" href="#publish-and-use-your-service" id="id18">Publish and use your Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#buffermask-service" id="id19">BufferMask Service</a><ul>
<li><a class="reference internal" href="#id6" id="id20">The ZCFG</a></li>
<li><a class="reference internal" href="#id7" id="id21">The JavaScript service</a></li>
<li><a class="reference internal" href="#id8" id="id22">Publish and use your Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bufferrequest-service" id="id23">BufferRequest service</a><ul>
<li><a class="reference internal" href="#id10" id="id24">The ZCFG</a></li>
<li><a class="reference internal" href="#the-javascript-code" id="id25">The JavaScript code</a></li>
<li><a class="reference internal" href="#id11" id="id26">Publish and use your Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-union-into-the-chain" id="id27">Add Union into the chain</a></li>
<li><a class="reference internal" href="#conclusion" id="id28">Conclusion</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This section illustrate how you can use JavaScript on the server-side to chain
services together to build new ones. You will create a ZOO Services Provider
using the services you seen before and the WFS server using the ZOO-API. The
final goal is to query all POIs included in a buffer around a feature and
to highlight them using a mask around this buffer. The following screenshot show
you the expected result:</p>
<a class="reference internal image-reference" href="_images/BufferMaskAndRequest_Level_15.png"><img alt="_images/BufferMaskAndRequest_Level_15.png" class="align-center" src="_images/BufferMaskAndRequest_Level_15.png" style="width: 650px;" /></a>
<p>For the routing interface result should look like this:</p>
<a class="reference internal image-reference" href="_images/BufferMaskAndRequest_Routing_Level_15.png"><img alt="_images/BufferMaskAndRequest_Routing_Level_15.png" class="align-center" src="_images/BufferMaskAndRequest_Routing_Level_15.png" style="width: 650px;" /></a>
<p>You can decompose the result above in two different ones: the mask around the
buffer and the points included in the buffer. So you will create two different
Services: one called <code class="docutils literal"><span class="pre">BufferMask</span></code> and another one called <code class="docutils literal"><span class="pre">BufferRequest</span></code>.</p>
<p>But before implementing any JavaScript Service, you will get an overview of how
to use ZOO-API from your ZOO-Project installation in the next section.</p>
<p>As before, you first create a new directory to store files for your new Services
Provider:</p>
<div class="highlight-guess"><div class="highlight"><pre>mkdir -p ~/zoo-ws2013/jschains/cgi-env/
</pre></div>
</div>
</div>
<div class="section" id="zoo-api-overview">
<h2><a class="toc-backref" href="#table-of-contents">ZOO-API Overview</a><a class="headerlink" href="#zoo-api-overview" title="Permalink to this headline">¶</a></h2>
<p>ZOO-API and ZOO-Kernel JavaScript support make you able to run services
implemented in JavaScript on the server side. JavaScript is a popular programing
language but mostly used on the client side. Let say from a browser, but here it
is a bit different.</p>
<p>To support JavaScript language ZOO-Kernel use the
<a class="reference external" href="https://developer.mozilla.org/en/SpiderMonkey">SpiderMonkey</a> API to create a
javascript runtime environment from which it will load your JS file then extract
the function corresponding to the service to run it using the prefilled
parameters. The JavaScript runtime environment created by the ZOO-Kernel
depend on your setup. If you placed the <code class="docutils literal"><span class="pre">ZOO-api.js</span></code> and <code class="docutils literal"><span class="pre">ZOO-proj4js.js</span></code> in
the same directory as your ZOO-Kernel it means that your environment will
contains ZOO-API and Proj4js will be loaded before your service. In such case you can access to the Classes defined in the JavaScript ZOO-API
to manipulate geographic data, for more informations please refer to the
<a class="reference external" href="http://zoo-project.org/docs/api/index.html">ZOO-API Documentation</a>.</p>
<p>Even if it can be useful to run JavaScript on the server side, you should
remember that some basic JavaScript functions you are familiar with does not
exist or get a different behavior. For instance the simple <code class="docutils literal"><span class="pre">alert</span></code>
function will display messages in apache error logs rather than in a window when
used from a browser. The <code class="docutils literal"><span class="pre">alert</span></code> function can be used as follow:</p>
<div class="highlight-guess"><div class="highlight"><pre>alert(&quot;My alert message&quot;);
</pre></div>
</div>
<p>There is no XMLHttpRequest available in the JavaScript evironement your service
will run into. Hopefully, the ZOO-Kernel expose a C function to the JavaScript
world named: <code class="docutils literal"><span class="pre">JSRequest</span></code>. This function make you able from your JavaScript
services to call other WPS services (locally or remotelly) or other kind OGC
services such as WFS. When you are using the ZOO-API it is possible to call
Services using a <code class="docutils literal"><span class="pre">ZOO.Process</span></code> instance <a class="footnote-reference" href="#f3" id="id1">[1]</a>, to parse WPS Responses using
<code class="docutils literal"><span class="pre">ZOO.Format.WPS</span></code>
(cf. <a class="reference external" href="http://zoo-project.org/docs/api/zoo-process.html">ref</a>).</p>
<p>As for Python services you already seen in previous sections, the functions
corresponding to a Service should take three arguments: <code class="docutils literal"><span class="pre">conf</span></code>, <code class="docutils literal"><span class="pre">inputs</span></code> and
<code class="docutils literal"><span class="pre">outputs</span></code> <a class="footnote-reference" href="#f4" id="id2">[2]</a>. Nevertheless, as the ZOO-Kernel is not able to access the
values modified <a class="footnote-reference" href="#f5" id="id3">[3]</a> by the Service code, rather than returning an integer as
in Python, here you&#8217;ll need to return both the integer value representing the
Status of your Service in a JavaScript Object and the resulting <code class="docutils literal"><span class="pre">outputs</span></code>
values as an Object <a class="footnote-reference" href="#f6" id="id4">[4]</a>. You can see in the following an example of a JavaScript
Service code:</p>
<div class="highlight-none"><div class="highlight"><pre>function SampleService(conf,inputs,outputs){
  var resultValue=someComputation(inputs);
  return
    {
        result: ZOO.SERVICE_SUCCEEDED,
        outputs: { &quot;Result&quot;: { &quot;mimeType&quot;: &quot;application/json&quot;, &quot;value&quot;: resultValue } }
    };
}
</pre></div>
</div>
<p>Before starting to implement the Services we will need to get our final
BufferRequest service, let start with a simplier one.</p>
</div>
<div class="section" id="the-mask-service">
<h2><a class="toc-backref" href="#table-of-contents">The Mask Service</a><a class="headerlink" href="#the-mask-service" title="Permalink to this headline">¶</a></h2>
<p>In this section you will learn how to create your first JavaScript service which
will simply return a rectangular mask around a selected feature. To build this
mask you will use the Buffer service to create a buffer big enough around a
selected geometry to cover a significant part of your map. You can see the
expected result in the following screenshot:</p>
<a class="reference internal image-reference" href="_images/Mask_Level_12.png"><img alt="_images/Mask_Level_12.png" class="align-center" src="_images/Mask_Level_12.png" style="width: 650px;" /></a>
<p>As before, you will first start by writting the ZCFG, then you will write the
JavaScript source code and finish by publishing your Services Provider.</p>
<div class="section" id="the-zcfg">
<h3><a class="toc-backref" href="#table-of-contents">The ZCFG</a><a class="headerlink" href="#the-zcfg" title="Permalink to this headline">¶</a></h3>
<p>Open the file named
<code class="docutils literal"><span class="pre">~/zoo-ws2013/jschains/cgi-env/Mask.zcfg</span></code>
with your favorite text editor and add the following content:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[Mask]
 Title = Compute mask
 Abstract = Compute mask around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
<p>Here you simply define one default <code class="docutils literal"><span class="pre">ComplexData</span></code> for both <code class="docutils literal"><span class="pre">inputData</span></code> and
<code class="docutils literal"><span class="pre">Result</span></code>: a GML and a GeoJSON respectively <a class="footnote-reference" href="#f7" id="id5">[5]</a>.</p>
</div>
<div class="section" id="the-javascript-service">
<h3><a class="toc-backref" href="#table-of-contents">The JavaScript service</a><a class="headerlink" href="#the-javascript-service" title="Permalink to this headline">¶</a></h3>
<p>As you will have to request the Buffer service many times from your service, you
will first define a <code class="docutils literal"><span class="pre">Buffer</span></code> function as follow. It uses the <code class="docutils literal"><span class="pre">ZOO.Process</span></code>
to request the Buffer service you seen in the previous section.</p>
<p>Open a file named
<code class="docutils literal"><span class="pre">~/zoo-ws2013/jschains/cgi-env/foss4gws.js</span></code> and
add the following content:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">zoo_url</span><span class="o">=</span><span class="s1">&#39;http://localhost/cgi-bin/zoo_loader.cgi&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">mapfile</span><span class="o">=</span><span class="s2">&quot;/var/www/zoows2013-demo/map/w2013_1.map&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">mapserv_url</span><span class="o">=</span><span class="s2">&quot;http://localhost/cgi-bin/mapserv?map=&quot;</span><span class="o">+</span><span class="nx">mapfile</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="nx">bDist</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">JSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fWPS</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">WPS</span><span class="p">();</span>

  <span class="c1">// Pass the value as json</span>
  <span class="kd">var</span> <span class="nx">myInputs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputPolygon</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">inputData</span><span class="p">),</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
      <span class="nx">BufferDistance</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="nx">bDist</span> <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs</span><span class="o">=</span> <span class="p">{</span> <span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myProcess</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;BufferPy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult</span><span class="o">=</span><span class="nx">myProcess</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs</span><span class="p">,</span><span class="nx">myOutputs</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">myExecuteResult</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>From line 12 to 15, you give a GeoJSON string (created from <code class="docutils literal"><span class="pre">inputData</span></code>) for
InputPolygon and, on line 14, you set the BufferDistance value to <code class="docutils literal"><span class="pre">bDist</span></code>.
On line 16, you define Result as a ResponseDocument, so you&#8217;ll have to parse the
WPS response using the ZOO.Format.WPS, on line 21.</p>
<p>On line 17, you create a
<a class="reference external" href="http://zoo-project.org/docs/api/zoo-process.html#zoo-process">ZOO.Process</a>
instance providing the ZOO-Kernel url and the Service name. Then, on line 18, you
run the request passing inputs and outputs previously defined (from line 12 to 15).</p>
<p>Now, you get your <code class="docutils literal"><span class="pre">Buffer</span></code> function, it is time to create your first JavaScript
service. So, edit your <code class="docutils literal"><span class="pre">foss4gws.js</span></code> file you created before and add the following content:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">Mask</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>

  <span class="c1">// Read the input GML</span>
  <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="p">[</span><span class="s2">&quot;InputData&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]);</span>

  <span class="c1">// Compute Buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.015</span><span class="p">);</span>

  <span class="c1">// Create the Buffer result BBOX and store its geometry in a ZOO.Feature</span>
  <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
    <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="nx">t</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">finalG</span><span class="o">=</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">toGeometry</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>

  <span class="c1">// Return the created feature</span>
  <span class="k">return</span> <span class="p">{</span>
      <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
      <span class="nx">outputs</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Result&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
  <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="publish-and-use-your-service">
<h3><a class="toc-backref" href="#table-of-contents">Publish and use your Service</a><a class="headerlink" href="#publish-and-use-your-service" title="Permalink to this headline">¶</a></h3>
<p>Now you get both your ZCFG and your service code ready, you need to deploy your
new Services Provider using the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre>cp ~/zoo-ws2013/jschains/cgi-env/* /usr/lib/cgi-bin
</pre></div>
</div>
<p>Now you are ready to use your JavaScript service by loading the following <a class="reference external" href="http://localhost/zoows2013-demo/spatialtools.html">url</a>, click on a street then click on
the &#8220;Mask&#8221; button.</p>
</div>
</div>
<div class="section" id="buffermask-service">
<h2><a class="toc-backref" href="#table-of-contents">BufferMask Service</a><a class="headerlink" href="#buffermask-service" title="Permalink to this headline">¶</a></h2>
<p>In this section you will implement a simple JavaScript service which will be able create
a hole in the mask you created in <a class="reference external" href="#mask-service">previous section</a>. This service
will be used to highlight the buffer zone around a selected fature. You get a preview of
the expected result in the following screenshot:</p>
<a class="reference internal image-reference" href="_images/BufferMask_Level_15.png"><img alt="_images/BufferMask_Level_15.png" class="align-center" src="_images/BufferMask_Level_15.png" style="width: 650px;" /></a>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#table-of-contents">The ZCFG</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Open the file named
<code class="docutils literal"><span class="pre">~/zoo-ws2013/jschains/cgi-env/BufferMask.zcfg</span></code>
with your favorite text editor and copy / paste the following content:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[BufferMask]
 Title = Compute buffer mask
 Abstract = Compute buffer mask around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
<p>This ZCFG is similar to the previous one. Please, refer to comments in the
<a class="reference external" href="#the-zcfg">previous section</a> for more informations.</p>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#table-of-contents">The JavaScript service</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>In this Service you will use same source code (until line 19) you used in the
<a class="reference external" href="#the-javascript-service">previous section</a>. Indeed, you should compute the Mask
as you did before then compute Buffer for creating a hole in the mask (on line 22) to run
the Difference service (from line 25 to 40).</p>
<div class="highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kd">function</span> <span class="nx">BufferMask</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

   <span class="c1">// Create all required ZOO.formats</span>
   <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>
   <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>

   <span class="c1">// Read the input GML</span>
   <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="cp">[</span><span class="s2">&quot;InputData&quot;</span><span class="cp">][</span><span class="s2">&quot;value&quot;</span><span class="cp">]</span><span class="p">);</span>

   <span class="c1">// Compute Buffer</span>
   <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.015</span><span class="p">);</span>

   <span class="c1">// Create the Buffer result BBOX</span>
   <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
   <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
   <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
     <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="cp">[</span><span class="nx">t</span><span class="cp">]</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="kd">var</span> <span class="nx">finalG</span><span class="o">=</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">toGeometry</span><span class="p">();</span>

  <span class="c1">// Compute Buffer standard buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.0015</span><span class="p">);</span>

  <span class="c1">// Request Difference service using Buffer result and features in the BBOX</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>
  <span class="kd">var</span> <span class="nx">myProcess2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;DifferencePy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myInputs2</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputEntity1</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">finalG</span><span class="p">),</span>
          <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
      <span class="p">},</span>
      <span class="nx">InputEntity2</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">bufferResultAsJSON</span><span class="p">),</span>
          <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
      <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs2</span><span class="o">=</span> <span class="p">{</span><span class="nx">Result</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span>  <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult4</span><span class="o">=</span><span class="nx">myProcess2</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs2</span><span class="p">,</span><span class="nx">myOutputs2</span><span class="p">);</span>

   <span class="c1">// Return the bbox</span>
   <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>
   <span class="k">return</span> <span class="p">{</span>
       <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
       <span class="nx">outputs</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Result&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">myExecuteResult4</span> <span class="p">}</span> <span class="p">}</span>
   <span class="p">};</span>

 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#table-of-contents">Publish and use your Service</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Now, you can publish your service as you did <a class="reference external" href="#publish-your-service">before</a>. To
use your service, please use the following <a class="reference external" href="http://localhost/zoows2013-demo/spatialtools.html">url</a>.</p>
</div>
</div>
<div class="section" id="bufferrequest-service">
<h2><a class="toc-backref" href="#table-of-contents">BufferRequest service</a><a class="headerlink" href="#bufferrequest-service" title="Permalink to this headline">¶</a></h2>
<p>In this section, you will create a new Service: <code class="docutils literal"><span class="pre">BufferRequest</span></code> which will request
POIs included in the Buffer around a selected feature <a class="footnote-reference" href="#f8" id="id9">[6]</a>. You will use the <code class="docutils literal"><span class="pre">poi</span></code>
layer served as WFS through your local mapserver installation. You can see in the
following screenshot the expected result:</p>
<a class="reference internal image-reference" href="_images/BufferRequest_Level_15.png"><img alt="_images/BufferRequest_Level_15.png" class="align-center" src="_images/BufferRequest_Level_15.png" style="width: 650px;" /></a>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#table-of-contents">The ZCFG</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Open the file named
<code class="docutils literal"><span class="pre">~/zoo-ws2013/jschains/cgi-env/BufferRequest.zcfg</span></code>
with your favorite text editor and copy / paste the following content:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[BufferRequest]
 Title = Compute buffer request
 Abstract = Compute buffer request around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="the-javascript-code">
<h3><a class="toc-backref" href="#table-of-contents">The JavaScript code</a><a class="headerlink" href="#the-javascript-code" title="Permalink to this headline">¶</a></h3>
<p>As in the previous Service, you will compute a buffer around the input feature. But then
you will request POIs available in the Buffer extent using a WFS request to use them to
run <code class="docutils literal"><span class="pre">Intersection</span></code> service using the initial Buffer. The WFS request is useful to limit
the number of points to use when requesting the <code class="docutils literal"><span class="pre">Intersection</span></code> Service.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">BufferRequest</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>

  <span class="c1">// Read the input GML</span>
  <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="p">[</span><span class="s2">&quot;InputData&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]);</span>

  <span class="c1">// Compute Buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.0015</span><span class="p">);</span>

  <span class="c1">// Create the Buffer result BBOX</span>
  <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
    <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="nx">t</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="c1">// Request Intersection service using Buffer result and WFS request using the</span>
  <span class="c1">// BBOX</span>
  <span class="kd">var</span> <span class="nx">myProcess2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;Intersection&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">req</span><span class="o">=</span><span class="s2">&quot;&amp;amp;version=1.0.0&amp;amp;request=GetFeature&amp;amp;typename=poi1&quot;</span><span class="p">;</span>
  <span class="nx">req</span><span class="o">+=</span><span class="s2">&quot;&amp;amp;SRS=EPSG:4326&amp;amp;BBOX=&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">myInputs2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">InputEntity1</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">bufferResultAsJSON</span><span class="p">),</span>
      <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
    <span class="p">},</span>
    <span class="nx">InputEntity2</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="nx">xlink</span><span class="o">:</span> <span class="nx">mapserv_url</span><span class="o">+</span><span class="nx">req</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">left</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">bottom</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">right</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span>
      <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;text/xml&quot;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs2</span><span class="o">=</span> <span class="p">{</span><span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult4</span><span class="o">=</span><span class="nx">myProcess2</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs2</span><span class="p">,</span><span class="nx">myOutputs2</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
    <span class="nx">outputs</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Result&quot;</span><span class="p">,</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">myExecuteResult4</span><span class="p">}</span> <span class="p">]</span>
  <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">to take advantage of the ZOO-Kernel cache system, you directly use the WFS
request  as <code class="docutils literal"><span class="pre">xlink:href</span></code> rather than value for <code class="docutils literal"><span class="pre">InputEntity2</span></code> (from line 31 to 34) and use <code class="docutils literal"><span class="pre">text/xml</span></code> <code class="docutils literal"><span class="pre">mimeType</span></code>
(on line 40). Indeed, the ZOO-API doesn&#8217;t use the internal cache mechanisms.</p>
</div>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#table-of-contents">Publish and use your Service</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Now, you can publish your service as you did <a class="reference external" href="#publish-your-service">before</a>. To
use your service, please use the following <a class="reference external" href="http://localhost/zoows2013-demo/spatialtools.html">url</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can click on &#8220;Buffer Request and Mask&#8221;  to get the same result as presented
in  <a class="reference external" href="#introduction">the initial screenshot</a>.</p>
</div>
</div>
</div>
<div class="section" id="add-union-into-the-chain">
<h2><a class="toc-backref" href="#table-of-contents">Add Union into the chain</a><a class="headerlink" href="#add-union-into-the-chain" title="Permalink to this headline">¶</a></h2>
<p>As you can see in the following screenshot, when using the Buffer
service using a feature collection containing more than one geometry,
the result is made of multiple geometries. So, running Buffer service
on the routing interface will result in multiple buffer:</p>
<a class="reference internal image-reference" href="_images/Buffer_Routing_Level_15.png"><img alt="_images/Buffer_Routing_Level_15.png" class="align-center" src="_images/Buffer_Routing_Level_15.png" style="width: 650px;" /></a>
<p>So, to get the same result as you got when selecting a single
road, you should use Union of geometry (input or the one outputed by the
<code class="docutils literal"><span class="pre">Buffer</span></code> Service). As you are using the JavaScript ZOO-API, you can
simply update the <code class="docutils literal"><span class="pre">Buffer</span></code> JavaScript function you defined earlier, to
first call the Union of each geometry avaible in a feature collection
prior to request (or after requesting) the Buffer Service. Hopefully,
there is already this Python Service available, its name is
<code class="docutils literal"><span class="pre">UnionOne1</span></code>, so you just need to add it in your Service chain.</p>
<p>Here is the final code for the Buffer JavaScript function:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="nx">bDist</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">JSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fWPS</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">WPS</span><span class="p">();</span>

  <span class="c1">// Call the UnionOne1 Service</span>
  <span class="kd">var</span> <span class="nx">myInputs0</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputPolygon</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">inputData</span><span class="p">),</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
      <span class="nx">BufferDistance</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="nx">bDist</span> <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs0</span><span class="o">=</span> <span class="p">{</span> <span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myProcess0</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;UnionOne1&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult0</span><span class="o">=</span><span class="nx">myProcess0</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs0</span><span class="p">,</span><span class="nx">myOutputs0</span><span class="p">);</span>

  <span class="c1">// Call the BufferPy Service</span>
  <span class="kd">var</span> <span class="nx">myInputs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputPolygon</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">myExecuteResult0</span><span class="p">,</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
      <span class="nx">BufferDistance</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="nx">bDist</span> <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs</span><span class="o">=</span> <span class="p">{</span> <span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myProcess</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;BufferPy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult</span><span class="o">=</span><span class="nx">myProcess</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs</span><span class="p">,</span><span class="nx">myOutputs</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">myExecuteResult</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#table-of-contents">Conclusion</a><a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>After understanding how basic Geometric Operation Services works, here you built step by step new JavaScript services which reuse the previous ones and combine them in different ways. This was achieved using the ZOO-API, composed by C functions exposed by the ZOO-Kernel to the JavaScript services runtime environement and the JS files which can be optionally installed.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The <code class="docutils literal"><span class="pre">ZOO.Process</span></code> class uses <code class="docutils literal"><span class="pre">JSRequest</span></code> (cf. <a class="reference external" href="http://zoo-project.org/docs/api/zoo-format-wps.html">ref</a>). You will get example
of use <a class="reference external" href="#the-javascript-service">later</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>So <code class="docutils literal"><span class="pre">conf</span></code>, <code class="docutils literal"><span class="pre">inputs</span></code> and <code class="docutils literal"><span class="pre">outputs</span></code> are simple JavaScript objects, similar
to the Python dictionaries used in the <a class="reference external" href="ogr_base_vect_ops.html">previous section</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Such as <code class="docutils literal"><span class="pre">conf</span></code>, <code class="docutils literal"><span class="pre">inputs</span></code> and <code class="docutils literal"><span class="pre">outputs</span></code>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>You can also return a conf Object if you get any informations updated from your JavaScript service (such as cookie for instance)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td>Using one of the available <code class="docutils literal"><span class="pre">ZOO.formats</span></code> you are also able to support various
<code class="docutils literal"><span class="pre">ComplexData</span></code> for both input and output of the service. To simplify the
presentation here, you will use only this default ones.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[6]</a></td><td>So in the hole you created in the previous section.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="building_blocks_presentation.html" class="btn btn-neutral" title="Building blocks presentation - Using OGR and PgRouting based Web Services"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  <div class="pfoot">
  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2015, ZOO-Project team.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> inspired by <a href="https://readthedocs.org">Read the Docs</a>.
</div>
</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>